'use babel';
/**
 * @author Titus Wormer
 * @copyright 2015 Titus Wormer
 * @license MIT
 * @module atom:linter-markdown
 * @fileoverview Linter.
 */

/* eslint-disable import/no-extraneous-dependencies, import/no-unresolved */

var CompositeDisposable = require('atom').CompositeDisposable;
var path = require('path');
var config = require('./config');

var engine = undefined;
var processor = undefined;
var subscriptions = undefined;
var scopes = undefined;
var detectIgnore = undefined;

function lint(editor) {
  return engine({
    processor: processor,
    detectIgnore: detectIgnore,
    rcName: '.remarkrc',
    rcPath: path.resolve(__dirname, 'config.js'),
    packageField: 'remarkConfig',
    ignoreName: '.remarkignore',
    presetPrefix: 'remark-preset',
    pluginPrefix: 'remark'
  })(editor);
}

/**
 * Linter-markdown.
 *
 * @return {LinterConfiguration}
 */
function provideLinter() {
  if (!engine) {
    engine = require('unified-engine-atom');
  }

  if (!processor) {
    processor = require('remark');
  }

  return {
    grammarScopes: scopes,
    name: 'remark-lint',
    scope: 'file',
    lintOnFly: true,
    lint: lint
  };
}

function activate() {
  require('atom-package-deps').install('linter-markdown');

  subscriptions = new CompositeDisposable();

  subscriptions.add(atom.config.observe('linter-markdown.scopes', function (value) {
    scopes = value;
  }));
  subscriptions.add(atom.config.observe('linter-markdown.detectIgnore', function (value) {
    detectIgnore = value;
  }));

  config.on();
}

function deactivate() {
  subscriptions.dispose();

  config.off();
}

/*
 * Expose.
 */
module.exports = {
  activate: activate,
  deactivate: deactivate,
  provideLinter: provideLinter
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2Vwc2UvRXBDb25mRmlsZXMvYXRvbS8uYXRvbS9wYWNrYWdlcy9saW50ZXItbWFya2Rvd24vbGliL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVcsQ0FBQzs7Ozs7Ozs7Ozs7QUFXWixJQUFNLG1CQUFtQixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQztBQUNoRSxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDOztBQUVuQyxJQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsSUFBSSxTQUFTLFlBQUEsQ0FBQztBQUNkLElBQUksYUFBYSxZQUFBLENBQUM7QUFDbEIsSUFBSSxNQUFNLFlBQUEsQ0FBQztBQUNYLElBQUksWUFBWSxZQUFBLENBQUM7O0FBRWpCLFNBQVMsSUFBSSxDQUFDLE1BQU0sRUFBRTtBQUNwQixTQUFPLE1BQU0sQ0FBQztBQUNaLGFBQVMsRUFBVCxTQUFTO0FBQ1QsZ0JBQVksRUFBWixZQUFZO0FBQ1osVUFBTSxFQUFFLFdBQVc7QUFDbkIsVUFBTSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQztBQUM1QyxnQkFBWSxFQUFFLGNBQWM7QUFDNUIsY0FBVSxFQUFFLGVBQWU7QUFDM0IsZ0JBQVksRUFBRSxlQUFlO0FBQzdCLGdCQUFZLEVBQUUsUUFBUTtHQUN2QixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7Q0FDWjs7Ozs7OztBQU9ELFNBQVMsYUFBYSxHQUFHO0FBQ3ZCLE1BQUksQ0FBQyxNQUFNLEVBQUU7QUFDWCxVQUFNLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7R0FDekM7O0FBRUQsTUFBSSxDQUFDLFNBQVMsRUFBRTtBQUNkLGFBQVMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7R0FDL0I7O0FBRUQsU0FBTztBQUNMLGlCQUFhLEVBQUUsTUFBTTtBQUNyQixRQUFJLEVBQUUsYUFBYTtBQUNuQixTQUFLLEVBQUUsTUFBTTtBQUNiLGFBQVMsRUFBRSxJQUFJO0FBQ2YsUUFBSSxFQUFKLElBQUk7R0FDTCxDQUFDO0NBQ0g7O0FBRUQsU0FBUyxRQUFRLEdBQUc7QUFDbEIsU0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7O0FBRXhELGVBQWEsR0FBRyxJQUFJLG1CQUFtQixFQUFFLENBQUM7O0FBRTFDLGVBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsd0JBQXdCLEVBQUUsVUFBQyxLQUFLLEVBQUs7QUFDekUsVUFBTSxHQUFHLEtBQUssQ0FBQztHQUNoQixDQUFDLENBQUMsQ0FBQztBQUNKLGVBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsOEJBQThCLEVBQUUsVUFBQyxLQUFLLEVBQUs7QUFDL0UsZ0JBQVksR0FBRyxLQUFLLENBQUM7R0FDdEIsQ0FBQyxDQUFDLENBQUM7O0FBRUosUUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDO0NBQ2I7O0FBRUQsU0FBUyxVQUFVLEdBQUc7QUFDcEIsZUFBYSxDQUFDLE9BQU8sRUFBRSxDQUFDOztBQUV4QixRQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7Q0FDZDs7Ozs7QUFLRCxNQUFNLENBQUMsT0FBTyxHQUFHO0FBQ2YsVUFBUSxFQUFSLFFBQVE7QUFDUixZQUFVLEVBQVYsVUFBVTtBQUNWLGVBQWEsRUFBYixhQUFhO0NBQ2QsQ0FBQyIsImZpbGUiOiIvaG9tZS9lcHNlL0VwQ29uZkZpbGVzL2F0b20vLmF0b20vcGFja2FnZXMvbGludGVyLW1hcmtkb3duL2xpYi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuLyoqXG4gKiBAYXV0aG9yIFRpdHVzIFdvcm1lclxuICogQGNvcHlyaWdodCAyMDE1IFRpdHVzIFdvcm1lclxuICogQGxpY2Vuc2UgTUlUXG4gKiBAbW9kdWxlIGF0b206bGludGVyLW1hcmtkb3duXG4gKiBAZmlsZW92ZXJ2aWV3IExpbnRlci5cbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMsIGltcG9ydC9uby11bnJlc29sdmVkICovXG5cbmNvbnN0IENvbXBvc2l0ZURpc3Bvc2FibGUgPSByZXF1aXJlKCdhdG9tJykuQ29tcG9zaXRlRGlzcG9zYWJsZTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBjb25maWcgPSByZXF1aXJlKCcuL2NvbmZpZycpO1xuXG5sZXQgZW5naW5lO1xubGV0IHByb2Nlc3NvcjtcbmxldCBzdWJzY3JpcHRpb25zO1xubGV0IHNjb3BlcztcbmxldCBkZXRlY3RJZ25vcmU7XG5cbmZ1bmN0aW9uIGxpbnQoZWRpdG9yKSB7XG4gIHJldHVybiBlbmdpbmUoe1xuICAgIHByb2Nlc3NvcixcbiAgICBkZXRlY3RJZ25vcmUsXG4gICAgcmNOYW1lOiAnLnJlbWFya3JjJyxcbiAgICByY1BhdGg6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdjb25maWcuanMnKSxcbiAgICBwYWNrYWdlRmllbGQ6ICdyZW1hcmtDb25maWcnLFxuICAgIGlnbm9yZU5hbWU6ICcucmVtYXJraWdub3JlJyxcbiAgICBwcmVzZXRQcmVmaXg6ICdyZW1hcmstcHJlc2V0JyxcbiAgICBwbHVnaW5QcmVmaXg6ICdyZW1hcmsnXG4gIH0pKGVkaXRvcik7XG59XG5cbi8qKlxuICogTGludGVyLW1hcmtkb3duLlxuICpcbiAqIEByZXR1cm4ge0xpbnRlckNvbmZpZ3VyYXRpb259XG4gKi9cbmZ1bmN0aW9uIHByb3ZpZGVMaW50ZXIoKSB7XG4gIGlmICghZW5naW5lKSB7XG4gICAgZW5naW5lID0gcmVxdWlyZSgndW5pZmllZC1lbmdpbmUtYXRvbScpO1xuICB9XG5cbiAgaWYgKCFwcm9jZXNzb3IpIHtcbiAgICBwcm9jZXNzb3IgPSByZXF1aXJlKCdyZW1hcmsnKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZ3JhbW1hclNjb3Blczogc2NvcGVzLFxuICAgIG5hbWU6ICdyZW1hcmstbGludCcsXG4gICAgc2NvcGU6ICdmaWxlJyxcbiAgICBsaW50T25GbHk6IHRydWUsXG4gICAgbGludFxuICB9O1xufVxuXG5mdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgcmVxdWlyZSgnYXRvbS1wYWNrYWdlLWRlcHMnKS5pbnN0YWxsKCdsaW50ZXItbWFya2Rvd24nKTtcblxuICBzdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcblxuICBzdWJzY3JpcHRpb25zLmFkZChhdG9tLmNvbmZpZy5vYnNlcnZlKCdsaW50ZXItbWFya2Rvd24uc2NvcGVzJywgKHZhbHVlKSA9PiB7XG4gICAgc2NvcGVzID0gdmFsdWU7XG4gIH0pKTtcbiAgc3Vic2NyaXB0aW9ucy5hZGQoYXRvbS5jb25maWcub2JzZXJ2ZSgnbGludGVyLW1hcmtkb3duLmRldGVjdElnbm9yZScsICh2YWx1ZSkgPT4ge1xuICAgIGRldGVjdElnbm9yZSA9IHZhbHVlO1xuICB9KSk7XG5cbiAgY29uZmlnLm9uKCk7XG59XG5cbmZ1bmN0aW9uIGRlYWN0aXZhdGUoKSB7XG4gIHN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuXG4gIGNvbmZpZy5vZmYoKTtcbn1cblxuLypcbiAqIEV4cG9zZS5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFjdGl2YXRlLFxuICBkZWFjdGl2YXRlLFxuICBwcm92aWRlTGludGVyXG59O1xuIl19
//# sourceURL=/home/epse/EpConfFiles/atom/.atom/packages/linter-markdown/lib/index.js
