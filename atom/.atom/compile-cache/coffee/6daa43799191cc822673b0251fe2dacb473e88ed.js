(function() {
  var $, FrontMatter, config, create, getDateTime, getEditor, getFileRelativeDir, getFileSlug, getFrontMatter, getFrontMatterDate, getTemplateVariables, parseFrontMatterDate, path, utils,
    __slice = [].slice;

  $ = require("atom-space-pen-views").$;

  path = require("path");

  config = require("../config");

  utils = require("../utils");

  FrontMatter = require("./front-matter");

  create = function() {
    var data, key;
    key = arguments[0], data = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    data = $.extend.apply($, [{}, getTemplateVariables()].concat(__slice.call(data)));
    return utils.template(config.get(key), data);
  };

  getTemplateVariables = function() {
    return $.extend({
      site: config.get("siteUrl")
    }, config.get("templateVariables") || {});
  };

  getDateTime = function(date) {
    if (date == null) {
      date = new Date();
    }
    return utils.getDate(date);
  };

  getFrontMatterDate = function(dateTime) {
    return utils.template(config.get("frontMatterDate"), dateTime);
  };

  parseFrontMatterDate = function(str) {
    var dateHash, fn;
    fn = utils.untemplate(config.get("frontMatterDate"));
    dateHash = fn(str);
    if (dateHash) {
      return utils.parseDate(dateHash);
    }
  };

  getFrontMatter = function(frontMatter) {
    return {
      layout: frontMatter.getLayout(),
      published: frontMatter.getPublished(),
      title: frontMatter.getTitle(),
      slug: frontMatter.getSlug(),
      date: frontMatter.getDate(),
      extension: frontMatter.getExtension()
    };
  };

  getFileSlug = function(filePath) {
    var filename, hash, template, templates, _i, _len;
    if (!filePath) {
      return "";
    }
    filename = path.basename(filePath);
    templates = [config.get("newPostFileName"), config.get("newDraftFileName"), "{slug}{extension}"];
    for (_i = 0, _len = templates.length; _i < _len; _i++) {
      template = templates[_i];
      hash = utils.untemplate(template)(filename);
      if (hash && (hash["slug"] || hash["title"])) {
        return hash["slug"] || hash["title"];
      }
    }
  };

  getFileRelativeDir = function(filePath) {
    var fileDir, siteDir;
    if (!filePath) {
      return "";
    }
    siteDir = utils.getSitePath(config.get("siteLocalDir"));
    fileDir = path.dirname(filePath);
    return path.relative(siteDir, fileDir);
  };

  getEditor = function(editor) {
    var data, frontMatter;
    frontMatter = new FrontMatter(editor, {
      silent: true
    });
    data = frontMatter.getContent();
    data["category"] = frontMatter.getArray(config.get("frontMatterNameCategories", {
      allow_blank: false
    }))[0];
    data["tag"] = frontMatter.getArray(config.get("frontMatterNameTags", {
      allow_blank: false
    }))[0];
    data["directory"] = getFileRelativeDir(editor.getPath());
    data["slug"] = getFileSlug(editor.getPath()) || utils.slugize(data["title"], config.get("slugSeparator"));
    data["extension"] = path.extname(this.draftPath) || config.get("fileExtension");
    return data;
  };

  module.exports = {
    create: create,
    getTemplateVariables: getTemplateVariables,
    getDateTime: getDateTime,
    getFrontMatter: getFrontMatter,
    getFrontMatterDate: getFrontMatterDate,
    parseFrontMatterDate: parseFrontMatterDate,
    getEditor: getEditor,
    getFileSlug: getFileSlug
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiL2hvbWUvZXBzZS8uYXRvbS9wYWNrYWdlcy9tYXJrZG93bi13cml0ZXIvbGliL2hlbHBlcnMvdGVtcGxhdGUtaGVscGVyLmNvZmZlZSIKICBdLAogICJuYW1lcyI6IFtdLAogICJtYXBwaW5ncyI6ICJBQUFBO0FBQUEsTUFBQSxvTEFBQTtJQUFBLGtCQUFBOztBQUFBLEVBQUMsSUFBSyxPQUFBLENBQVEsc0JBQVIsRUFBTCxDQUFELENBQUE7O0FBQUEsRUFDQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FEUCxDQUFBOztBQUFBLEVBR0EsTUFBQSxHQUFTLE9BQUEsQ0FBUSxXQUFSLENBSFQsQ0FBQTs7QUFBQSxFQUlBLEtBQUEsR0FBUSxPQUFBLENBQVEsVUFBUixDQUpSLENBQUE7O0FBQUEsRUFLQSxXQUFBLEdBQWMsT0FBQSxDQUFRLGdCQUFSLENBTGQsQ0FBQTs7QUFBQSxFQVFBLE1BQUEsR0FBUyxTQUFBLEdBQUE7QUFDUCxRQUFBLFNBQUE7QUFBQSxJQURRLG9CQUFLLDhEQUNiLENBQUE7QUFBQSxJQUFBLElBQUEsR0FBTyxDQUFDLENBQUMsTUFBRixVQUFTLENBQUEsRUFBQSxFQUFJLG9CQUFBLENBQUEsQ0FBd0IsU0FBQSxhQUFBLElBQUEsQ0FBQSxDQUFyQyxDQUFQLENBQUE7V0FDQSxLQUFLLENBQUMsUUFBTixDQUFlLE1BQU0sQ0FBQyxHQUFQLENBQVcsR0FBWCxDQUFmLEVBQWdDLElBQWhDLEVBRk87RUFBQSxDQVJULENBQUE7O0FBQUEsRUFZQSxvQkFBQSxHQUF1QixTQUFBLEdBQUE7V0FDckIsQ0FBQyxDQUFDLE1BQUYsQ0FBUztBQUFBLE1BQUUsSUFBQSxFQUFNLE1BQU0sQ0FBQyxHQUFQLENBQVcsU0FBWCxDQUFSO0tBQVQsRUFBMEMsTUFBTSxDQUFDLEdBQVAsQ0FBVyxtQkFBWCxDQUFBLElBQW1DLEVBQTdFLEVBRHFCO0VBQUEsQ0FadkIsQ0FB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

//# sourceURL=/home/epse/.atom/packages/markdown-writer/lib/helpers/template-helper.coffee
